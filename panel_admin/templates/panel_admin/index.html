{% extends "panel_admin/plantillas/base.html" %}

{% block title %}Panel Admin{% endblock %}
{% load static %}
<!--Para cargar las imagenes-->
{% block content %}
<div class="row">
    <div class="col-md-12 mb-4 mt-1">
        <div class="d-flex flex-wrap justify-content-between align-items-center">
            <h4 class="font-weight-bold">Estadisticas Generales</h4>
            <div class="form-group mb-0 vanila-daterangepicker d-flex flex-row">
                <!--<div class="date-icon-set">
                    <input type="text" name="start" class="form-control" placeholder="Partir de la fecha">
                    <span class="search-link">
                        <svg xmlns="http://www.w3.org/2000/svg" class="" width="20" fill="none" viewBox="0 0 24 24"
                            stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                        </svg>
                    </span>
                </div>-->
                <span class="flex-grow-0">
                    <a href="{% url 'index' %}" class="btn">Hola, Actualizar :)</a>
                </span>
                <!--<div class="date-icon-set">
                    <input type="text" name="end" class="form-control" placeholder="Hasta la fecha">
                    <span class="search-link">
                        <svg xmlns="http://www.w3.org/2000/svg" class="" width="20" fill="none" viewBox="0 0 24 24"
                            stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                        </svg>
                    </span>
                </div>-->
            </div>
        </div>
    </div>
    <div class="col-lg-8 col-md-12">
        <div class="row">
            <div class="col-md-4">
                <div class="card">
                    <div class="card-body">
                        <div class="d-flex align-items-center">
                            <div class="">
                                <p class="mb-2 text-secondary">Total de Alumnos</p>
                                <div class="d-flex flex-wrap justify-content-between align-items-center">

                                    <svg xmlns="http://www.w3.org/2000/svg" width="30" viewBox="0 0 24 24"
                                        fill="currentColor" class="w-6 h-6">
                                        <path
                                            d="M4.5 6.375a4.125 4.125 0 118.25 0 4.125 4.125 0 01-8.25 0zM14.25 8.625a3.375 3.375 0 116.75 0 3.375 3.375 0 01-6.75 0zM1.5 19.125a7.125 7.125 0 0114.25 0v.003l-.001.119a.75.75 0 01-.363.63 13.067 13.067 0 01-6.761 1.873c-2.472 0-4.786-.684-6.76-1.873a.75.75 0 01-.364-.63l-.001-.122zM17.25 19.128l-.001.144a2.25 2.25 0 01-.233.96 10.088 10.088 0 005.06-1.01.75.75 0 00.42-.643 4.875 4.875 0 00-6.957-4.611 8.586 8.586 0 011.71 5.157v.003z" />
                                    </svg>
                                    <h5 class="mb-0 font-weight-bold">{{total_alumnos}}</h5>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card">
                    <div class="card-body">
                        <div class="d-flex align-items-center">
                            <div class="">
                                <p class="mb-2 text-secondary">Total de Colegios</p>
                                <div class="d-flex flex-wrap justify-content-between align-items-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="30" viewBox="0 0 24 24"
                                        fill="currentColor" class="w-6 h-6">
                                        <path
                                            d="M11.7 2.805a.75.75 0 01.6 0A60.65 60.65 0 0122.83 8.72a.75.75 0 01-.231 1.337 49.949 49.949 0 00-9.902 3.912l-.003.002-.34.18a.75.75 0 01-.707 0A50.009 50.009 0 007.5 12.174v-.224c0-.131.067-.248.172-.311a54.614 54.614 0 014.653-2.52.75.75 0 00-.65-1.352 56.129 56.129 0 00-4.78 2.589 1.858 1.858 0 00-.859 1.228 49.803 49.803 0 00-4.634-1.527.75.75 0 01-.231-1.337A60.653 60.653 0 0111.7 2.805z" />
                                        <path
                                            d="M13.06 15.473a48.45 48.45 0 017.666-3.282c.134 1.414.22 2.843.255 4.285a.75.75 0 01-.46.71 47.878 47.878 0 00-8.105 4.342.75.75 0 01-.832 0 47.877 47.877 0 00-8.104-4.342.75.75 0 01-.461-.71c.035-1.442.121-2.87.255-4.286A48.4 48.4 0 016 13.18v1.27a1.5 1.5 0 00-.14 2.508c-.09.38-.222.753-.397 1.11.452.213.901.434 1.346.661a6.729 6.729 0 00.551-1.608 1.5 1.5 0 00.14-2.67v-.645a48.549 48.549 0 013.44 1.668 2.25 2.25 0 002.12 0z" />
                                        <path
                                            d="M4.462 19.462c.42-.419.753-.89 1-1.394.453.213.902.434 1.347.661a6.743 6.743 0 01-1.286 1.794.75.75 0 11-1.06-1.06z" />
                                    </svg>
                                    <h5 class="mb-0 font-weight-bold">{{total_colegios}}</h5>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card">
                    <div class="card-body">
                        <div class="d-flex align-items-center">
                            <div class="">
                                <p class="mb-2 text-secondary">Fichas Expedidas</p>
                                <div class="d-flex flex-wrap justify-content-between align-items-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="30" viewBox="0 0 24 24"
                                        fill="currentColor" class="w-6 h-6">
                                        <path fill-rule="evenodd"
                                            d="M6 3a3 3 0 00-3 3v12a3 3 0 003 3h12a3 3 0 003-3V6a3 3 0 00-3-3H6zm1.5 1.5a.75.75 0 00-.75.75V16.5a.75.75 0 001.085.67L12 15.089l4.165 2.083a.75.75 0 001.085-.671V5.25a.75.75 0 00-.75-.75h-9z"
                                            clip-rule="evenodd" />
                                    </svg>
                                    <h5 class="mb-0 font-weight-bold">{{total_encuestas}}</h5>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-12">
                <div class="card">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center flex-wrap">
                            <h4 class="font-weight-bold">Reporte por genero</h4>
                            <div class="d-flex justify-content-between align-items-center">
                                <div><svg width="24" height="24" viewBox="0 0 24 24" fill="primary"
                                        xmlns="http://www.w3.org/2000/svg">
                                        <rect x="3" y="3" width="18" height="18" rx="2" fill="#3378FF" />
                                    </svg>
                                    <span>Masculino</span>
                                </div>
                                <div class="ml-3"><svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                                        xmlns="http://www.w3.org/2000/svg">
                                        <rect x="3" y="3" width="18" height="18" rx="2" fill="#19b3b3" />
                                    </svg>
                                    <span>Femenino</span>
                                </div>
                            </div>
                        </div>
                        <!--<div id="chart-apex-column-01" class="custom-chart"></div>-->
                        <div id="chart">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-lg-4 col-md-8">
        <div class="card card-block card-stretch card-height">
            <div class="card-header card-header-border d-flex justify-content-between">
                <div class="header-title">
                    <h4 class="card-title">Top 4 colegios con mas test realizados</h4>
                </div>
            </div>
            <div class="card-body-list">
                <ul class="list-style-3 mb-0">
                    {% for colegio in colegios_top %}
                    <li class="p-3 list-item d-flex justify-content-start align-items-center">
                        <div class="avatar">
                            <img class="avatar avatar-img avatar-60 rounded" src="{{colegio.logo}}" alt="1.jpg">
                        </div>
                        <div class="list-style-detail ml-3 mr-2">
                            <p class="mb-0">{{colegio.colegio}}</p>
                        </div>
                        <div class="list-style-action d-flex justify-content-end ml-auto">
                            <h6 class="font-weight-bold">{{colegio.cantidad}}</h6>
                        </div>
                    </li>
                    {% endfor %}
                </ul>
            </div>
        </div>

    </div>

    <div class="col-md-4">
        <div class="row">
            <div class="col-md-12">
                <div class="card bg-primary">
                    <div class="card-body" style="min-height: 120px !important;">
                        <div class="d-flex align-items-center">
                            <div class="fit-icon-2 text-info text-center">
                                <div id="circle-progress-01"
                                    class="circle-progress-01 circle-progress circle-progress-light" data-min-value="0"
                                    data-max-value="100" data-value="" data-type="percent">
                                    <script>
                                        total_colegios = '{{total_colegios}}';
                                        porcentaje = (total_colegios * 100) / 125;
                                        document.getElementById("circle-progress-01").setAttribute("data-value", porcentaje);
                                    </script>
                                </div>
                            </div>
                            <div class="ml-3">
                                <h5 class="text-white font-weight-bold">{{total_colegios}} <small>/125 Colegios de
                                        Cusco</small>
                                </h5>
                                <small class="mb-0">Accedieron al servicio de sovio</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-8">
        <div class="row">
            <div class="col-md-12">
                <div class="card bg-success">
                    <div class="card-body" style="min-height: 120px !important;">
                        <div class="d-flex align-items-center">
                            <div class="ml-3">
                                <h5 class="text-white font-weight-bold">Nombre de Año</h5>
                                <p class="mb-0">"Año de la paz y reconciliación nacional"</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-lg-12 col-md-12">
        <div class="card">
            <div class="card-header d-flex justify-content-between">
                <div class="header-title">
                    <h4 class="card-title">Ultimos Test</h4>
                </div>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table mb-0">
                        <thead class="table-color-heading">
                            <tr class="text-secondary">
                                <th scope="col">Fecha</th>
                                <th scope="col">Alumno</th>
                                <th scope="col">Colegio</th>
                                <th scope="col">Ficha</th>
                                <th scope="col">Estado</th>
                                <th scope="col" class="text-right">Preguntas respondidas</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for alumnos_encuesta in alumnos_encuestas %}
                            <tr class="white-space-no-wrap">
                                <td>{{alumnos_encuesta.fecha}}</td>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <div class="avatar-45 mr-2">

                                            {% if alumnos_encuesta.genero == 1 %}
                                            <img src="{% static 'panel_admin/images/user/5.jpg' %}" alt="" width="45">
                                            {% elif alumnos_encuesta.genero == 0 %}
                                            <img src="{% static 'panel_admin/images/user/6.jpg' %}" alt="" width="45">
                                            {% else %}
                                            <span class="badge badge-warning">Sin definir :: Error</span>
                                            {% endif %}

                                        </div>
                                        <div>{{alumnos_encuesta.nombre}}</div>
                                    </div>
                                </td>
                                <td>{{alumnos_encuesta.colegio}}</td>
                                <td>
                                    {% if alumnos_encuesta.estado == 1 %}
                                    <a href="{% url 'generar_pdf' alumnos_encuesta.id_alumno %}"
                                        class="btn btn-sm btn-primary">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="20" fill="none"
                                            viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
                                            class="w-6 h-6">
                                            <path stroke-linecap="round" stroke-linejoin="round"
                                                d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" />
                                        </svg>
                                        Ver Ficha
                                    </a>
                                    {% else %}
                                    <button class="btn btn-sm btn-warning" disabled>
                                        <svg xmlns="http://www.w3.org/2000/svg" width="20" fill="none"
                                            viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
                                            class="w-6 h-6">
                                            <path stroke-linecap="round" stroke-linejoin="round"
                                                d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" />
                                        </svg>
                                        Pendiente
                                    </button>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if alumnos_encuesta.estado == 1 %}
                                    <p class="mb-0 text-success d-flex justify-content-start align-items-center">
                                        <small><svg class="mr-2" xmlns="http://www.w3.org/2000/svg" width="18"
                                                viewBox="0 0 24 24" fill="none">
                                                <circle cx="12" cy="12" r="8" fill="#3cb72c"></circle>
                                            </svg>
                                        </small> Completado
                                    </p>
                                    {% else %}
                                    <p class="mb-0 text-warning d-flex justify-content-start align-items-center">
                                        <small><svg class="mr-2" xmlns="http://www.w3.org/2000/svg" width="18"
                                                viewBox="0 0 24 24" fill="none">
                                                <circle cx="12" cy="12" r="8" fill="#db7e06"></circle>
                                            </svg>
                                        </small>Pendiente
                                    </p>
                                    {% endif %}
                                </td>
                                <td class="text-right">{{alumnos_encuesta.cantidad}} /
                                    <strong>{{alumnos_encuesta.total}}</strong></td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                    <div class="d-flex justify-content-end align-items-center border-top-table p-3">
                        <a href="{% url 'encuestas' %}" class="btn btn-secondary btn-sm">Ver todos</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
<script>
    let sexo_alumno = '{{sexo_alumno|safe}}';
    sexo_alumno = JSON.parse(sexo_alumno);
    var meses = [];
    var cantidad_m = [];
    var cantidad_f = [];
    for (let i = 0; i < sexo_alumno.length; i++) {
        // alamacenar los datos en un array meses.sexos
        meses.push(sexo_alumno[i].meses);
        cantidad_m.push(sexo_alumno[i].m);
        cantidad_f.push(sexo_alumno[i].f);
    }
    var options = {
        series: [{
            name: 'Masculino',
            data: cantidad_m
        }, {
            name: 'Femenino',
            // quitan los decimales
            data: cantidad_f
        }],
        chart: {
            height: 350,
            type: 'area'
        },
        dataLabels: {
            enabled: false
        },
        stroke: {
            curve: 'smooth'
        },
        xaxis: {
            type: 'date',
            // meses en español
            categories: meses
        },
        tooltip: {
            x: {
                format: 'dd/MM/yy'
            },
        },
    };
    var chart = new ApexCharts(document.querySelector("#chart"), options);
    chart.render();
</script>
{% if messages %}
{% for message in messages %}
{% if message.tags == 'success' %}
<script>
    Swal.fire({
        toast: true,
        position: 'top-end',
        icon: 'success',
        title: '{{ message }}',
        showConfirmButton: false,
        timer: 1500,
        timerProgressBar: true,
    })
</script>
{% endif %}
{% if message.tags == 'error' %}
<script>
    Swal.fire({
        toast: true,
        position: 'top-end',
        icon: 'error',
        title: '{{ message }}',
        showConfirmButton: false,
        timer: 1500,
        timerProgressBar: true,
    })
</script>
{% endif %}
{% endfor %}
{% endif %}
{% endblock %}
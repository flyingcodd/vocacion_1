{% extends "panel_admin/plantillas/base.html" %}
{% block title %}Reportes{% endblock %}

{% block content %}

<div class="row">
    <div class="col-sm-12 col-lg-12">
        <div class="card">
            <div class="card-header d-flex justify-content-between">
                <div class="header-title">
                    <h4 class="card-title">Reporte de colegios</h4>
                </div>
                <!--select boorar esta con hidden-->
                <form action="" method="post" id="form" hidden>{% csrf_token %}
                <div class="card-header d-flex justify-content-between">
                
                    <div class="d-flex align-items-center">
                        <div class="modal-product-search d-flex">
                           <div class="mr-3 position-relative" >
                                <div class="form-group mb-0">
                                    <select class="form-control" id="fecha_inicio" name="fecha_inicio" style="width: 200px;">
                                        {% for reporte in reportes_grafico %}
                                        <option value="{{reporte.mes}}" {% if ultimo_mes == reporte.mes %} selected {% endif %}>{{reporte.mes}}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="d-flex align-items-center">
                        <div class="modal-product-search d-flex">
                            <div class="mr-3 position-relative" >
                                <div class="form-group mb-0">
                                    <select class="form-control" name="fecha_fin" id="fecha_fin" style="width: 200px;">
                                        {% for reporte in reportes_grafico %}
                                        <option value="{{reporte.mes}}">{{reporte.mes}}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-success">Filtrar</button>
                
                </div>
            </form>
            </div>
            <div class="card-body">
                <!--tabla datatable-->
                <!--<div class="table-responsive">
                    <table id="datatable" class="table table-striped table-bordered">
                        <thead>
                            <tr>
                                <th>Mes</th>
                                <th>Colegio</th>
                                <th>Estudiates Atendidos</th>
                                <th>Sexo M</th>
                                <th>Sexo F</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for reporte in reportes %}
                            <tr>
                                <td>{{reporte.mes}}</td>
                                <td>{{reporte.colegio}}</td>
                                <td>{{reporte.alumnos}}</td>
                                <td>{{reporte.m}}</td>
                                <td>{{reporte.f}}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>-->
                <div class="table-responsive">
                    <table class="table data-table mb-0 table-hover table-striped table-bordered" id="tabla_reporte_por_colegio">
                        <thead>
                            <tr>
                                <th>Mes</th>
                                <th>Colegio</th>
                                <th>Estudiates Atendidos</th>
                                <th>Sexo M</th>
                                <th>Sexo F</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for reporte in reportes %}
                            <tr>
                                <td>{{reporte.mes}}</td>
                                <td>{{reporte.colegio}}</td>
                                <td>{{reporte.alumnos}}</td>
                                <td>{{reporte.m}}</td>
                                <td>{{reporte.f}}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>

            </div>
        </div>
    </div>
    
    <!--reportes por sexo-->
    <div class="col-sm-12 col-lg-12">
        <div class="card">
            <div class="card-header d-flex justify-content-between">
                <div class="header-title">
                    <h4 class="card-title">Reporte de test evaludados por mes</h4>
                </div>
                <!--select-->
                <!-- <div class="card-header d-flex justify-content-between">
                    <div class="d-flex align-items-center">
                        <div class="modal-product-search d-flex">
                            <form class="mr-3 position-relative">
                                <div class="form-group mb-0">
                                    <select class="form-control" id="exampleFormControlSelect1" style="width: 200px;">
                                        <option>Junio - 2021</option>
                                        <option>Junio - 2022</option>
                                        <option>Noviembre - 2022</option>
                                    </select>
                                </div>
                            </form>
                        </div>
                    </div>
                    <div class="d-flex align-items-center">
                        <div class="modal-product-search d-flex">
                            <form class="mr-3 position-relative">
                                <div class="form-group mb-0">
                                    <select class="form-control" id="exampleFormControlSelect1" style="width: 200px;">
                                        <option>Junio - 2021</option>
                                        <option>Junio - 2022</option>
                                        <option>Noviembre - 2022</option>
                                    </select>
                                </div>
                            </form>
                        </div>
                    </div>
                    <button type="button" class="btn btn-success">Filtrar</button>
                </div> -->
            </div>
            <div class="card-body">
                <!--tabla datatable-->
                <div class="table-responsive">
                    <table class="table data-table mb-0 table-hover table-striped table-bordered">
                        <thead>
                            <tr>
                                <th>Mes</th>
                                <th>Estudiates Atendidos</th>
                                <th>Sexo M</th>
                                <th>Sexo F</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for reporte in reportes_grafico %}
                            <tr>
                                <td>{{reporte.mes}}</td>
                                <td>{{reporte.alumnos}}</td>
                                <td>{{reporte.m}}</td>
                                <td>{{reporte.f}}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>

            </div>
            <div class="col-sm-12 col-lg-12">
                <div class="a">
                    <div class="card-header d-flex justify-content-between">
                        <div class="header-title">
                            <h4 class="card-title">Grafico</h4>
                        </div>
                    </div>
                    <div class="card-body">
                        <div id="asd"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
</div>
<script
  src="https://code.jquery.com/jquery-3.6.1.js"
  integrity="sha256-3zlB5s2uwoUzrXK3BT7AX3FyvojsraNFxCc2vC/7pNI="
  crossorigin="anonymous"></script>
<script>
    // reporte general con ajax filtrado del form
    $(document).ready(function() {
        $('#form').on('submit', function(event) {
            event.preventDefault();
            fecha_inicio = $('#fecha_inicio').val();
            fecha_fin = $('#fecha_fin').val();
            $.ajax({
                url: "{% url 'reporte_general' %}",
                method: "POST",
                data: {
                    fecha_inicio: fecha_inicio,
                    fecha_fin: fecha_fin,
                    csrfmiddlewaretoken: '{{ csrf_token }}'
                },
                success: function(data) {
                    // recargar la datatable con los datos
                    $('#tabla_reporte_por_colegio').DataTable().clear().destroy();
                    // poner tama√±o de las celadas
                    $('#tabla_reporte_por_colegio').DataTable({
                        "columnDefs": [{
                            "width": "20%",
                            "targets": 0
                        }, {
                            "width": "20%",
                            "targets": 1
                        }, {
                            "width": "20%",
                            "targets": 2
                        }, {
                            "width": "20%",
                            "targets": 3
                        }, {
                            "width": "20%",
                            "targets": 4
                        }]
                    });
                    for (var i = 0; i < data.reportes.length; i++) {
                        $('#tabla_reporte_por_colegio').DataTable().row.add([
                            data.reportes[i].mes,
                            data.reportes[i].colegio,
                            data.reportes[i].alumnos,
                            data.reportes[i].m,
                            data.reportes[i].f
                        ]).draw();
                    }
                }
            })
        });
    });

    
</script>
<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
<script>
    var options = {
        chart: {
            height: 350,
            type: 'line',
            zoom: {
                enabled: false
            },
        },
        dataLabels: {
            enabled: false
        },
        stroke: {
            curve: 'straight'
        },
        series: [{
            name: "Test realizados",
            // convertir a int
            data: '{{list_alumnos|safe}}'.split(',')
        }],
        title: {
            text: 'Evolucion de test realizados',
            align: 'left'
        },
        grid: {
            row: {
                colors: ['#f3f3f3', 'transparent'], // takes an array which will be repeated on columns
                opacity: 0.5
            },
        },
        xaxis: {
            // list_mes de la base de datos
            categories: '{{list_meses|safe}}'.split(','),
        }
    }

    var chart = new ApexCharts(
        document.querySelector("#asd"),
        options
    );

    chart.render();
    // imprimendo las lista de meses
    //console.log('{{list_alumnos|safe}}');
</script>

{% endblock %}